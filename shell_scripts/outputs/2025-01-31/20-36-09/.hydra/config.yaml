base:
  seed: 1234
  amp: true
  image_size: 224
  text_max_length: 256
  loss_best: contrastive
  data_frac: 1.0
  output:
    checkpoint: ${hydra:run.dir}/checkpoints/
    tensorboard: ${hydra:run.dir}/tensorboard/
training_params:
  batch_size: 360
  num_workers: 10
  batch_style: experiment
  train_from_scratch: false
  epoch_based_patience: 25
  iteration_evaluate_frequency: 50
  text_cl_weight: 1.0
  ct_cl_weight: 1.0
  learning_rate: 5.0e-05
  weight_decay: 0.0001
  epochs: 202
  min_epochs: 202
  training_pretrain_baseline: ''
  use_pretrained_xray_encoder: true
linear_probing_params:
  baseline_type: modeltype_Swin__batchstyle_experiment__bs_360__lr_5e-05__wd_0.0001__textcl_1.0__ctcl_1.0__pretrained_False_50_epoch
  is_linear_probe_eval: true
  multi_sweep_evaluation: true
  num_epochs: 100
  patience: 20
  batch_size: 4096
  learning_rate: 0.05
  progress_window: 2
  num_workers: 10
  train_data_portion: 1
  evaluation_dataset: mimic
  cpt_dest: /cluster/projects/mcintoshgroup/CT-RATE-CHECKPOINTS/linear_probe_evaluation
zero_shot_params:
  baseline_type: ''
  test_bed: internal_ct_val
  num_workers: 10
  batch_size: 1024
xray_feature_caching_params:
  baseline_type: ''
  num_workers: 10
  batch_size: 1024
  evaluation_dataset: ct-rate
internal_split_caching_params:
  baseline_type: ''
  num_workers: 10
  batch_size: 1024
  train_data_portion: 0.1
  evaluation_dataset: mimic
data_train:
  mimic_cxr:
    name: mimic_cxr
    data_type: imagetext
    data_path: datasets/mimic_train.csv
    image_size: ${base.image_size}
    text_max_length: ${base.text_max_length}
    data_frac: 1.0
  chexpert:
    name: chexpert
    data_type: imagetext
    data_path: datasets/chexpert_train.csv
    image_size: ${base.image_size}
    text_max_length: ${base.text_max_length}
    prompt_from_json: true
    data_frac: 1.0
data_valid:
  mimic_cxr:
    name: mimic_cxr
    data_type: imagetext
    data_path: datasets/mimic_valid.csv
    image_size: ${base.image_size}
    text_max_length: ${base.text_max_length}
  chexpert:
    name: chexpert
    data_type: imagetext
    data_path: datasets/chexpert_valid.csv
    image_size: ${base.image_size}
    text_max_length: ${base.text_max_length}
    prompt_from_json: true
dataloader:
  train:
    pin_memory: true
    shuffle: true
    drop_last: true
    num_workers: 8
    prefetch_factor: 8
    batch_size: 128
  valid:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 8
    prefetch_factor: 8
    batch_size: 128
  test:
    pin_memory: true
    shuffle: false
    drop_last: false
    num_workers: 16
    batch_size: 128
tokenizer:
  source: huggingface
  pretrained_model_name_or_path: emilyalsentzer/Bio_ClinicalBERT
  cache_dir: huggingface/tokenizers
transform:
  train:
    RandomResizedCrop:
      size: ${base.image_size}
      scale:
      - 0.8
      - 1.1
    CLAHE:
      clip_limit: 4.0
    ColorJitter:
      brightness: 0.1
      contrast: 0.2
      saturation: 0.2
      hue: 0.1
    CenterCrop:
      size: ${base.image_size}
  valid:
    Resize:
      size: ${base.image_size}
    CenterCrop:
      size: ${base.image_size}
  test:
    Resize:
      size: ${base.image_size}
    CenterCrop:
      size: ${base.image_size}
model:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: torchvision
    name: resnet
    pretrained: true
    model_type: resnet
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: ./huggingface_downloads/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
resnet:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: torchvision
    name: resnet
    pretrained: true
    model_type: resnet
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: ./huggingface_downloads/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
swin:
  name: clip_custom
  temperature: 0.07
  image_encoder:
    source: huggingface
    name: microsoft/swin-tiny-patch4-window7-224
    pretrained: true
    model_type: swin
    cache_dir: /cluster/home/t135419uhn/CT-CLIP/predownloaded_models/cxr-swinTiny/
  text_encoder:
    source: huggingface
    name: emilyalsentzer/Bio_ClinicalBERT
    pretrained: true
    gradient_checkpointing: false
    pooling: eos
    cache_dir: ./huggingface_downloads/
    trust_remote_code: true
    mlm_head: true
  projection_head:
    name: linear
    dropout: 0.1
    proj_dim: 512
optimizer:
  name: adamw
  config:
    lr: 5.0e-05
    weight_decay: 0.0001
scheduler:
  name: cosine
  config:
    total_epochs: 15
    warmup_epochs: 1
loss:
  cxr_clip:
    label_smoothing: 0.0
    i2i_weight: 1.0
    t2t_weight: 0.5
    loss_ratio: 1.0
